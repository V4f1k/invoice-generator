# Story 2.2: Select Customer During Invoicing

## Status
- Approved

## Story
**As a** logged-in user,
**I want** to select a saved customer from a list when creating an invoice,
**so that** their details are auto-filled, saving me time and reducing errors.

## Acceptance Criteria
1. The invoice creation form is updated with a searchable dropdown or selection field for customers.
2. Selecting a customer from the list automatically populates the client detail fields on the form.
3. The user retains the option to manually enter details for a one-off client without saving them.

## Tasks / Subtasks
- [ ] **Task 1: Update Frontend Invoice Editor (AC: #1, #2, #3)**
  - [ ] Subtask 1.1: Modify the invoice editor component created in Story 1.4.
  - [ ] Subtask 1.2: Replace the manual client detail text fields with a searchable dropdown (e.g., a ShadCN Combobox).
  - [ ] Subtask 1.3: The dropdown should be populated by fetching data from the `GET /api/v1/customers` endpoint.
  - [ ] Subtask 1.4: Implement logic so that when a customer is selected, the form's client detail fields (name, address, IČO, DIČ) are automatically populated with the selected customer's data.
  - [ ] Subtask 1.5: Add a button or option such as "Enter Manually" that toggles the visibility of the manual input fields for one-off clients, allowing the user to bypass the selection.
- [ ] **Task 2: Update Backend Invoice Creation Logic (AC: #2)**
  - [ ] Subtask 2.1: Modify the `invoices` table and database migration to include an optional `customer_id` foreign key.
  - [ ] Subtask 2.2: Update the `POST /api/v1/invoices` endpoint to accept the optional `customer_id`.
  - [ ] Subtask 2.3: If a `customer_id` is provided, the endpoint should ignore any manually entered client details and link the invoice to the saved customer record.

## Dev Notes
- **i18n**: This story involves UI changes. Ensure all static text is implemented using the internationalization framework as per Story 4.1.
- This story modifies existing components and endpoints from Epic 1. Care must be taken to ensure the changes are well-tested and do not cause regressions.
- The searchable customer dropdown is a key UX feature. It should be fast and responsive, capable of handling a large number of customers efficiently. Consider client-side filtering for smaller lists or a debounced server-side search for larger lists.

### Testing
- Update integration tests for the `POST /invoices` endpoint to handle the new `customer_id` field and its interaction with manual client details.
- Component tests for the updated invoice editor are critical, especially for the searchable customer dropdown and the auto-population logic.
- An E2E test must cover the new primary user flow: creating an invoice by selecting a saved customer and verifying the correct data is saved.
- A regression E2E test must cover the manual entry flow to ensure it still works as expected.

## Change Log
| Date       | Version | Description                | Author |
| :--------- | :------ | :------------------------- | :----- |
| 2025-08-29 | 1.0     | Initial draft              | Sarah  |

---
## Dev Agent Record
*(This section is to be filled out by the Dev Agent during implementation)*

#### Agent Model Used

#### Debug Log References

#### Completion Notes List

#### File List

---
## QA Results
*(This section is to be filled out by the QA Agent after development)*
