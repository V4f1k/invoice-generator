---
Status: "Done"
---

# Story: Add Invoice Description Field

## User Story

As a user creating an invoice,
I want to be able to add a descriptive text block to the invoice,
So that I can include additional information, notes, or a summary of the service rendered before the itemized list.

## Story Context

**Existing System Integration:**

- **Integrates with:** Invoice creation form, Invoice API, Database, PDF generation service.
- **Technology:** Node.js, Prisma, Next.js, React, react-pdf.
- **Follows pattern:** Standard field addition (schema, API, UI, PDF template).
- **Touch points:**
    - `prisma/schema.prisma` (Invoice model)
    - `apps/api/src/routes/invoice.ts` (Zod schema and creation logic)
    - `apps/web/app/(app)/invoices/new/page.tsx` (or similar frontend form)
    - `apps/api/src/templates/InvoicePDFTemplate.tsx` (PDF layout)

## Acceptance Criteria

**Functional Requirements:**

1. A new optional text area field labeled "Popis" (Description) shall be available on the invoice creation form.
2. The "Popis" field should be positioned before the "Items" section of the form.
3. The content of the "Popis" field must be saved to the database when the invoice is created.
4. The saved "Popis" text must be displayed on the generated PDF, positioned before the itemized table.
5. If the "Popis" field is left empty, it should not appear on the invoice PDF.

**Integration Requirements:**

6. Existing invoices without a description must continue to display correctly.
7. The new functionality must follow the existing patterns for adding fields to the invoice.
8. Integration with the PDF generation service must handle both the presence and absence of the description text gracefully.

**Quality Requirements:**

9. The change must be covered by appropriate tests (API and potentially E2E).
10. No regressions in existing invoice functionality shall be introduced.

## Technical Notes

- **Integration Approach:**
    - Add an optional `description` string field to the `Invoice` model in `prisma/schema.prisma`.
    - Run `npx prisma migrate dev` to apply the database change.
    - Add `description: z.string().optional()` to the `createInvoiceSchema` in `apps/api/src/routes/invoice.ts`.
    - Update the frontend invoice form to include a `<Textarea>` for the `description`.
    - Pass the `description` from the invoice data to the `InvoicePDFTemplate` component.
    - Conditionally render the `description` in the PDF template.
- **Existing Pattern Reference:** Follow the implementation of other optional fields on the invoice, like `duzp`.
- **Key Constraints:** The field should support multi-line text.

## Definition of Done

- [x] Functional requirements met.
- [x] Integration requirements verified.
- [x] Existing functionality regression tested.
- [x] Code follows existing patterns and standards.
- [x] Tests pass (existing and new).
- [x] Documentation updated if applicable.
