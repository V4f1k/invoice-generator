# Story 2.4: Link Invoice to Project

## Status
- Draft

## Story
**As a** logged-in user,
**I want** to associate an invoice with a specific project,
**so that** I can easily see which invoices belong to which body of work.

## Acceptance Criteria
1. The invoice form is updated with an optional dropdown to select a project.
2. The selected project is saved as a property of the invoice.
3. The project association is visible on the invoice view page.

## Tasks / Subtasks
- [ ] **Task 1: Update Invoice Database Table (AC: #2)**
  - [ ] Subtask 1.1: Add an optional `project_id` foreign key to the `invoices` table, referencing the `projects` table.
  - [ ] Subtask 1.2: Implement and apply the database migration.
- [ ] **Task 2: Update Invoice API Endpoints (AC: #2, #3)**
  - [ ] Subtask 2.1: Update the `POST /api/v1/invoices` endpoint to accept the optional `project_id` in the request body.
  - [ ] Subtask 2.2: Update the `GET /api/v1/invoices/{id}` endpoint to include the associated project information (if any) in the response.
- [ ] **Task 3: Update Frontend Invoice Editor and View (AC: #1, #3)**
  - [ ] Subtask 3.1: Add an optional, searchable dropdown for "Project" to the invoice editor form, similar to the customer selection.
  - [ ] Subtask 3.2: Populate the dropdown by fetching data from the `GET /api/v1/projects` endpoint.
  - [ ] Subtask 3.3: On the invoice view page (`/invoices/[id]`), display the name of the associated project, linking to the project's page if applicable.

## Dev Notes
- **i18n**: This story involves UI changes. Ensure all static text is implemented using the internationalization framework as per Story 4.1.
- This story is functionally similar to selecting a customer for an invoice (Story 2.2). The same patterns and components should be reused.
- The project association is optional. The system must gracefully handle invoices that are not linked to any project.

### Testing
- Update integration tests for the `POST /invoices` and `GET /invoices/{id}` endpoints to verify the handling of the new `project_id`.
- Component tests for the updated invoice editor should verify the project dropdown works correctly.
- An E2E test should cover creating an invoice, associating it with a project, and verifying the association is displayed correctly on the invoice view page.

## Change Log
| Date       | Version | Description                | Author |
| :--------- | :------ | :------------------------- | :----- |
| 2025-08-29 | 1.0     | Initial draft              | Sarah  |

---
## Dev Agent Record
*(This section is to be filled out by the Dev Agent during implementation)*

#### Agent Model Used

#### Debug Log References

#### Completion Notes List

#### File List

---
## QA Results
*(This section is to be filled out by the QA Agent after development)*
