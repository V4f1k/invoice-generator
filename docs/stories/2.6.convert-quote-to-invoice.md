# Story 2.6: Convert Quote to Invoice

## Status
- Draft

## Story
**As a** logged-in user,
**I want** to convert an approved quote into a new invoice with a single click,
**so that** I can begin the billing process instantly without duplicating my work.

## Acceptance Criteria
1. A "Convert to Invoice" action is available on a saved quote.
2. Executing the action creates a new, unsaved invoice pre-populated with all the data from the quote.
3. The new invoice is assigned a new, unique invoice number, distinct from the quote number.

## Tasks / Subtasks
- [ ] **Task 1: Implement Quote Conversion API Endpoint (AC: #2, #3)**
  - [ ] Subtask 1.1: Create a `POST /api/v1/quotes/{id}/convert` endpoint.
  - [ ] Subtask 1.2: The endpoint should read the data from the specified quote and its line items, ensuring the user owns the quote.
  - [ ] Subtask 1.3: It should then create a new invoice record in the `invoices` table, performing a deep copy of all relevant data (client info, line items, etc.).
  - [ ] Subtask 1.4: The new invoice must be assigned a new, unique invoice number from the standard invoice sequence.
  - [ ] Subtask 1.5: The endpoint should return the newly created invoice object.
- [ ] **Task 2: Add Conversion Button to Frontend (AC: #1)**
  - [ ] Subtask 2.1: Add a "Convert to Invoice" button to the quote view page (`/quotes/[id]`).
  - [ ] Subtask 2.2: When clicked, the button should call the `POST /api/v1/quotes/{id}/convert` endpoint.
  - [ ] Subtask 2.3: After a successful response, the user should be redirected to the view page for the newly created invoice (e.g., `/invoices/[new_invoice_id]`).
- [ ] **Task 3: (Optional) Update Quote Status**
  - [ ] Subtask 3.1: Add a `status` field to the `quotes` table (e.g., Draft, Sent, Accepted, Invoiced).
  - [ ] Subtask 3.2: When a quote is converted, its status should be updated to "Invoiced".

## Dev Notes
- **i18n**: This story involves UI changes. Ensure all static text is implemented using the internationalization framework as per Story 4.1.
- The conversion process should create a completely new invoice record. It is a deep copy, not a reference. All line items and other details must be duplicated.
- The user experience upon conversion should be clear. Redirecting to the newly created invoice's view page is a good default, as it confirms the action was successful.

### Testing
- An integration test for the `POST /quotes/{id}/convert` endpoint is critical. The test must verify that a new invoice is created with a new, correct invoice number and that all data from the quote is copied correctly.
- An E2E test should cover the full user flow: viewing a saved quote, clicking the "Convert to Invoice" button, and verifying that a new invoice is created and displayed correctly.

## Change Log
| Date       | Version | Description                | Author |
| :--------- | :------ | :------------------------- | :----- |
| 2025-08-29 | 1.0     | Initial draft              | Sarah  |

---
## Dev Agent Record
*(This section is to be filled out by the Dev Agent during implementation)*

#### Agent Model Used

#### Debug Log References

#### Completion Notes List

#### File List

---
## QA Results
*(This section is to be filled out by the QA Agent after development)*
